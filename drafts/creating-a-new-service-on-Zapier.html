<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <title>There And Back - Creating a new service on Zapier.</title>
    <meta name="description" content="">
    <meta name="author" content="José Moreira">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" href="favicon.ico" />
    <link href="../feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="There And Back ATOM Feed" />

    <!-- Google Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:700,400,400italic,700italic,600italic,600,300italic,300|Open+Sans+Condensed:300,300italic,700' rel='stylesheet' type='text/css'>

    <!-- webassets -->
    <link rel="stylesheet" href="../theme/css/main.css?8c0f9eda">

<script>var _gaq=[['_setAccount','UA-26838427-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
<script type="text/javascript">
	var disqus_identifier = "drafts/creating-a-new-service-on-Zapier.html";
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = 'http://zemaneleu.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
</head>
<body>
    <div class="container">
        <header>
            <div class="row">
                <div class="span4 brand">
                    <h2><a href="..">There And Back</a></h2>
                </div>
                <div class="span8">
                    <div class="nav">
                        <a class="btn btn-small btn-inverse active" href="../index.html"><i class="icon-white icon-home"></i> Home</a>
                        <a class="btn btn-small btn-inverse active" href="../pages/resume.html"><i class="icon-white icon-book"></i> Resume</a>
                        <a class="btn btn-small btn-inverse active" href="../archives.html"><i class="icon-white icon-briefcase"></i> Archives</a>
                        <a class="btn btn-small btn-inverse active" href="../categories.html"><i class="icon-white icon-folder-close"></i> Categories</a>
                        <a class="btn btn-small btn-inverse active" href="../tags.html"><i class="icon-white icon-tag"></i> Tags</a>
                    </div>
                </div>
            </div>
        </header>
        <div class="row">
            <!-- sidebar -->
            <div class="span2">
<div id="sidebar">
    <!-- Logo -->
    <div id="logo"><img src="../theme/images/logo.jpg" alt="site logo" /></div>
    <!-- social links -->
    <h3>Social</h3>
    <ul class="nav social">
        <li><a class="icon" href="http://twitter.com/zemanel">Twitter</a></li>
        <li><a class="icon" href="http://github.com/zemanel">Github</a></li>
        <li><a class="icon" href="http://bitbucket.org/zemanel">Bitbucket</a></li>
        <li><a class="icon" href="http://careers.stackoverflow.com/zemanel">Careers 2.0</a></li>
        <li><a class="icon" href="http://pt.linkedin.com/in/josemoreira">Linkedin</a></li>
        <li><a class="icon" href="http://stackoverflow.com/users/2278823/zemanel">StackOverflow</a></li>
        <li><a class="icon" href="http://www.last.fm/user/jose.moreira">Last.fm</a></li>
        <li><a class="icon" href="http://facebook.com/OVerdadeiroJoseMoreira">Facebook</a></li>
    </ul>
    <h3>Blogs</h3>
    <ul class="nav">
        <li><a href="http://blog.getpelican.com"><i class="icon-globe"></i> GetPelican</a></li>
    </ul>
</div>            </div>
            <!-- content -->
            <div class="content span10">
                <div class="inner">
    <div class="article">
        <div class="title"><h1>Creating a new service on Zapier.</h1></div>
        <div class="metadata"><p>
    <strong>created</strong> <a href="../drafts/creating-a-new-service-on-Zapier.html">2013-07-11 02:00:00+01:00</a>
    <i class="icon-folder-close"></i> <strong>category</strong> <a href="../category/programming.html">programming</a>
    <i class="icon-tag"></i> <strong>tags</strong>     <a href="../tag/zapier.html">zapier</a>    <a href="../tag/api.html">api</a></p></div>
        <div class="post"><p>Part of my work as a freelancer in the latest months has been supporting vendors on <a href="https://www.zapier.com">https://www.zapier.com</a>, developing new services through the developer console to integrate their REST API on Zapier's catalog. I'd like to go through the considerations and how simple it was to integrate my latest happy client.</p>
<p><img alt="zapier automate the web" src="/static/images/2013/07/11/zapier-automate-the-web.png" /></p>
<h3>Analyzing the APIs</h3>
<p>I was just recently referenced a client that wanted to automate his business with Zapier, by automatically creating client records on a CRM from purchase order data from <a href="https://www.ecwid.com">https://www.ecwid.com</a>'s API. There are already several options on Zapiers catalog but ECWID was not yet integrated, so a new service was developed to poll data from ECWID and expose it to other services, in this case with the intend of feeding it to an existing CRM service, although after the service and it's data trigger are created, the trigger can be connected to whatever other Zapier service Action.</p>
<p>The client ended up by choosing <a href="http://highrisehq.com">http://highrisehq.com</a> but any of the other available CRM would work just just as well.</p>
<p>The first step is to analyze <a href="http://kb.ecwid.com/w/page/43697230/Order%20API">ECWID's API documentation</a>. Starting with the authentication, ECWID API requires a <strong>secret key</strong> and a <strong>store id</strong>, the <strong>secret key</strong> being a request parameter and the <strong>store id</strong> being part of the endpoint path as follows:</p>
<p>https://app.ecwid.com/api/v1/&lt;<strong>store id</strong>&gt;/orders?secure_auth_key=<strong>secret key</strong>.</p>
<p>Zapier's authentication mechanisms are very flexible so this is not a problem at all.</p>
<p>Next, retrieving the data itself can be done by polling from the Orders list endpoint. Zapiers <a href="https://zapier.com/developer/reference/#dedupe">new data deduplication</a> requires two things:</p>
<ul>
<li>for each result item to have an unique globally identifing key named <code>id</code></li>
<li>for the results to be sorted reverse-chronologically by time created.</li>
</ul>
<p>By inspecting the response of a test request using <code>curl</code>, orders are already sorted from newest to oldest but reading the <a href="http://kb.ecwid.com/w/page/43697230/Order%20API#Response">Order result schema</a> schema, results do not have an <code>id</code> key, but have an order <code>number</code>. This can be solved using Zapier <a href="https://zapier.com/developer/scripting/">Javascript API</a> to process the results after polling and copy the <code>number</code> value to an <code>id</code> key for each item.</p>
<p>Another important aspect is that Zapier expects the results top level structure to be the item list itself. In this case, although common, the top level data is metadata, with the orders list itself being under the <code>orders</code> key:</p>
<div class="highlight"><pre><span class="p">{</span>
    <span class="s2">&quot;count&quot;</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="s2">&quot;total&quot;</span><span class="o">:</span> <span class="mi">579</span><span class="p">,</span>
    <span class="s2">&quot;nextUrl&quot;</span><span class="o">:</span> <span class="s2">&quot;...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;orders&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="c1">// Order object</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="c1">// Order object</span>
        <span class="p">},</span>
        <span class="p">...</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>


<p>Problem ? No problem, we can also return only the <code>orders</code> object list while processing the results with Javascript API.</p>
<h3>Putting it all together</h3>
<p>Heading over to the <a href="https://zapier.com/developer/">Developer dashboard</a>, let's create a new service:</p>
<p><img alt="ecwid service details" src="/static/images/2013/07/11/ecwid-service-details.png" /></p>
<p>ECWID has two distinct API's, Products and Orders, each with a distinct private API key. This service will relate to Orders only, since i believe it's more sensible to separate Orders and Products into different services, due to each having it's own private key.</p>
<p>Next we edit the authentication mapping. This will be used for Zapier to authenticate the request calls. The authentication type will be <em>query string</em> since it's what is required by ECWID.</p>
<p><img alt="ecwid auth mapping" src="/static/images/2013/07/11/ecwid-auth-mapping.png" /></p></div>
        <div class="comments">
            <h2>Comments</h2>
            <div id="social-share">
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="zemanel">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
<div class="g-plusone" data-size="medium" data-annotation="inline" data-width="200"></div>
<script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
</script>            </div>
<div id="disqus_thread"></div>        </div>
    </div>
                </div>
            </div>
        </div>
        <!-- footer -->
        <footer>
            <p>
                <small>
                <a href="../index.html">There And Back</a>,
                a <a href="http://docs.getpelican.com">Pelican</a> blog by &copy; José Moreira 2013
                <a class="icon" href="../feeds/all.atom.xml">RSS</a>
                <a class="icon" href="https://github.com/zemanel/zemanel.eu/">Source Code</a>
                </small>
            </p>
        </footer>

    </div>
</body>
</html>